# Интернационализация Music Cutter

**Дата:** 2025-01-08
**Статус:** Design

## Обзор

Добавление поддержки английского и русского языков в приложение Music Cutter с переключателем рядом с темой.

## Архитектура и Структура

### Библиотека

**react-i18next** — стандарт де-факто для React с отличной TypeScript поддержкой.

### Структура файлов

```
src/locales/
├── index.ts              # Экспорт ресурсов и тип Translations
├── en.ts                 # Английские переводы
└── ru.ts                 # Русские переводы

src/i18n/
├── config.ts             # Конфигурация i18next
├── types.ts              # Тип Translations
└── useTypedTranslation.ts # Типизированный хук

src/components/
└── LanguageToggle.tsx    # Переключатель языка
```

### Провайдер

`I18nextProvider` оборачивает приложение в `src/main.tsx`:

```typescript
<ThemeProvider>
  <I18nextProvider i18n={i18n}>
    <ChakraProvider>
      <App />
    </ChakraProvider>
  </I18nextProvider>
</ThemeProvider>
```

### Хранилище языка

- **Ключ:** `music-cutter-language`
- **Значения:** `en` | `ru`
- **По умолчанию:** `en`

### Конфигурация i18next

```typescript
i18n.use(initReactI18next).init({
  resources: { en: { translation: en }, ru: { translation: ru } },
  lng: localStorage.getItem('music-cutter-language') || 'en',
  fallbackLng: 'en',
  interpolation: { escapeValue: false },
})
```

## Компонент LanguageToggle

### Расположение

Рядом с `ThemeToggle` в `src/App.tsx`.

```tsx
<Flex gap={2}>
  <LanguageToggle />
  <ThemeToggle />
</Flex>
```

### UI

- `IconButton` с иконкой глобуса
- При клике переключает `en ↔ ru`
- Показывает тост-уведомление о смене языка

### Логика

```typescript
const { i18n } = useTranslation()
const currentLang = i18n.language

const toggleLanguage = () => {
  const newLang = currentLang === 'en' ? 'ru' : 'en'
  i18n.changeLanguage(newLang)
  localStorage.setItem('music-cutter-language', newLang)
}
```

### Иконки

- `LuGlobe` для текущего языка
- Или флаги: `EnFlag` / `RuFlag` если есть в react-icons

## Структура переводов (TypeScript модули)

### Формат src/locales/en.ts

```typescript
export const en = {
  // Common
  common: {
    language: 'Language',
    theme: 'Theme',
    selectFile: 'Select File',
    save: 'Save',
    cancel: 'Cancel',
  },
  // Audio Cutter Tab
  audioCutter: {
    title: 'Audio Cutter',
    selectAudio: 'Select Audio File',
    startTime: 'Start Time',
    endTime: 'End Time',
    cut: 'Cut Fragment',
  },
  // Batch Cutter Tab
  batchCutter: {
    title: 'Batch Cutter',
    selectAudio: 'Select Source File',
    outputFolder: 'Output Folder',
    process: 'Process All',
  },
  // ... остальные секции
} as const

export type Translations = typeof en
```

### src/locales/ru.ts

Идентичная структура с русскими значениями, импортирует тип из `en.ts`:

```typescript
import type { Translations } from './en'

export const ru: Translations = {
  common: {
    language: 'Язык',
    theme: 'Тема',
    selectFile: 'Выбрать файл',
    save: 'Сохранить',
    cancel: 'Отмена',
  },
  // ...
}
```

### Использование в компонентах

```tsx
import { useTypedTranslation } from '@/i18n/useTypedTranslation'

const { t } = useTypedTranslation()
<Button>{t('audioCutter.cut')}</Button>
```

## Типизация ключей переводов

### src/i18n/types.ts

```typescript
import { en } from '@/locales/en'

export type Translations = typeof en

declare module 'react-i18next' {
  export interface Resources {
    translation: Translations
  }
}
```

### Типизированный хук src/i18n/useTypedTranslation.ts

```typescript
import { useTranslation as usei18n } from 'react-i18next'
import type { Translations } from './types'

export function useTypedTranslation() {
  const { t, ...rest } = usei18n()

  return {
    t: (key: keyof Translations, params?: Record<string, unknown>) =>
      t(key as string, params),
    ...rest,
  }
}
```

### Вложенные ключи

Для вложенных ключей используется string-literal типы через Template Literal Types:

```typescript
type NestedKey<T> = T extends object
  ? { [K in keyof T]: K extends string ? `${K}.${NestedKey<T[K]>}` : never }[keyof T]
  : never
```

## Миграция существующих компонентов

### Компоненты для перевода (по приоритету)

1. **src/App.tsx** — табы "Audio Cutter" / "Batch Cutter"
2. **src/features/audioCutter/** — вся UI форма (поля, кнопки, лейблы)
3. **src/features/batchCutter/** — вся UI форма
4. **src/components/ThemeToggle.tsx** — tooltips
5. **src/components/LanguageToggle.tsx** — tooltips
6. **Валидационные сообщения** — react-hook-form errors
7. **Тосты/уведомления** — success/error сообщения

### Подход

Каждая feature папка имеет свою секцию в переводах:
- `audioCutter: { ... }`
- `batchCutter: { ... }`

### Интерполяция

```typescript
// locales
audioCutter: {
  processing: 'Processing {{track}} of {{total}}...',
}

// component
t('audioCutter.processing', { track: 1, total: 10 })
```

## Зависимости

```bash
npm install i18next react-i18next
```

## Следующие шаги

1. Установить зависимости
2. Создать структуру файлов
3. Настроить i18next
4. Создать LanguageToggle компонент
5. Перевести все UI строки
6. Протестировать оба языка
